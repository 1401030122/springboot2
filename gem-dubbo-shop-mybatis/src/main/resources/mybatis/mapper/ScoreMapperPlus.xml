<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.admin.mapper.ScoreMapperPlus">

    <resultMap id="MyScore" type="com.atguigu.admin.bean.Score">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="subject" jdbcType="VARCHAR" property="subject"/>
        <result column="score" jdbcType="INTEGER" property="score"/>
    </resultMap>

    <resultMap id="MyScoreDif2" type="com.atguigu.admin.bean.Score">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="subject" jdbcType="VARCHAR" property="subject"/>
        <result column="score" jdbcType="INTEGER" property="score"/>
        <association property="location" javaType="com.atguigu.admin.bean.Location">
            <result column="id2" jdbcType="INTEGER" property="id"/>
            <result column="countryside" jdbcType="VARCHAR" property="country"/>
        </association>
    </resultMap>

    <select id="getById" resultMap="MyScore">
        select * from score where id = #{id}
    </select>

  <!-- 直接将查询的次级表内容赋值到后面    -->
    <resultMap id="MyScoreDif" type="com.atguigu.admin.bean.Score">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="subject" jdbcType="VARCHAR" property="subject"/>
        <result column="id2" jdbcType="INTEGER" property="location.id"/>
        <result column="countryside" jdbcType="VARCHAR" property="location.country"/>
    </resultMap>


    <select id="getByIdAndLocation" resultMap="MyScoreDif2">
        SELECT s.id                     id,
               s.subject                subject,
               s.score                  score,
               s.name                   name,
               l.id                     id2,
               l.country                countryside
        FROM score s,location l
        WHERE l.id=s.location_id AND s.id =#{id}
    </select>




<!--    -->
     <!--     分布式查询方法，首先将普通的查询内容设置好，然后设置好分布查询的内容，
              关键点： 再用一次select查询内容
     -->

    <select id="getByIdStep" resultMap="MyScoreStep">
        select * from score where id=#{id};
    </select>

    <resultMap id="MyScoreStep" type="com.atguigu.admin.bean.Score">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="subject" jdbcType="VARCHAR" property="subject"/>
        <result column="score" jdbcType="VARCHAR" property="score"/>
        <association property="location"
                     select="com.atguigu.admin.mapper.LocationMapper.getById"
                     column="location_id">
        </association>
    </resultMap>

<!--    可以使用延迟加载，当使用的时候再加载分布加载的内容-->

    <select id="getByIf" resultMap="MyScoreDif2">
        select * from score where name = #{name}
        <if test="null != id ">
            and id =#{id}
        </if>
    </select>
    
    <select id="getByEach" resultMap="MyScoreDif2" parameterType="java.util.List">
        select * from score where id in 
        <foreach collection="list" index="index" open="(" close=")" item="id" separator=",">
            #{id}
        </foreach>
    </select>

</mapper>